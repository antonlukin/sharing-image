(()=>{"use strict";var e={n:t=>{var a=t&&t.__esModule?()=>t.default:()=>t;return e.d(a,{a}),a},d:(t,a)=>{for(var r in a)e.o(a,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:a[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.React,a=window.wp.i18n,r=window.wp.apiFetch;var n=e.n(r);const i=window.wp.element,s=window.wp.data,l=window.wp.plugins,o=window.wp.editPost,c=window.wp.components,m=window.wp.notices,u=({name:e,layer:a,fieldset:r,setFieldset:n,attribute:l})=>{const[o,m]=(0,i.useState)(!1),u=(0,s.useSelect)((e=>e("core/editor").getEditedPostAttribute(l)));return(0,i.useEffect)((()=>{o||n({...r,[e]:u})}),[u]),(0,t.createElement)(c.TextareaControl,{name:e,label:a.title,value:r[e],onChange:t=>(t=>{n({...r,[e]:t}),m(!0)})(t)})},d=({name:e,layer:a,fieldset:r,setFieldset:n,attribute:l,entity:o})=>{const[m,u]=(0,i.useState)(!1),d=(0,s.useSelect)((e=>{const t=[];let r=e("core/editor").getEditedPostAttribute(l);return r||(r=[]),r.forEach((a=>{const r=e("core").getEntityRecord("taxonomy",o,a);r&&t.push(r.name)})),t.join(a.separator||", ")}));return(0,i.useEffect)((()=>{m||n({...r,[e]:d})}),[d]),(0,t.createElement)(c.TextareaControl,{name:e,label:a.title,value:r[e],onChange:t=>(t=>{n({...r,[e]:t}),u(!0)})(t)})},g=(0,i.forwardRef)((function({icon:e,size:t=24,...a},r){return(0,i.cloneElement)(e,{width:t,height:t,...a,ref:r})})),p=window.wp.primitives,w=(0,t.createElement)(p.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},(0,t.createElement)(p.Path,{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM5 4.5h14c.3 0 .5.2.5.5v8.4l-3-2.9c-.3-.3-.8-.3-1 0L11.9 14 9 12c-.3-.2-.6-.2-.8 0l-3.6 2.6V5c-.1-.3.1-.5.4-.5zm14 15H5c-.3 0-.5-.2-.5-.5v-2.4l4.1-3 3 1.9c.3.2.7.2.9-.1L16 12l3.5 3.4V19c0 .3-.2.5-.5.5z"})),E=window.wp.blockEditor,h=({name:e,layer:r,mode:n,fieldset:l,setFieldset:o})=>{const m=(0,s.useSelect)((e=>e("core/editor").getEditedPostAttribute("featured_media"))),u=(0,s.useSelect)((t=>{const a=t("core").getMedia(l[e]);let r=a?.media_details?.sizes?.thumbnail?.source_url;return r||(r=a?.source_url),r}),[l]);(0,i.useEffect)((()=>{"manual"!==n&&"featured"===r.preset&&o({...l,[e]:m})}),[m]);const d=()=>{o({...l,[e]:0})};return(0,t.createElement)(E.MediaUploadCheck,null,(0,t.createElement)(E.MediaUpload,{onSelect:t=>{var a;a=t.id,o({...l,[e]:a})},allowedTypes:["image"],value:l[e],render:({open:r})=>l[e]?(0,t.createElement)(t.Fragment,null,u&&(0,t.createElement)("img",{src:u,alt:"",className:"g4qkvGu7xkyoImxRZ6GR"}),(0,t.createElement)(c.Button,{variant:"link",onClick:d},(0,a.__)("Remove image","sharing-image"))):(e=>(0,t.createElement)(t.Fragment,null,(0,t.createElement)(g,{icon:w,className:"ipnonin6Xj5A9QU3K38L"}),(0,t.createElement)(c.Button,{variant:"link",onClick:e},(0,a.__)("Set layer image","sharing-image"))))(r)}))},f=({layers:e,mode:a,fieldset:r,setFieldset:n})=>{const i=(e,a)=>(0,t.createElement)(c.TextareaControl,{name:a,label:e.title,defaultValue:r[a],onChange:e=>n({...r,[a]:e})}),s=(e,s)=>{if("manual"===a)return i(e,s);const l={name:s,layer:e,fieldset:r,setFieldset:n};switch(e.preset){case"title":return(0,t.createElement)(u,{...l,attribute:"title"});case"excerpt":return(0,t.createElement)(u,{...l,attribute:"excerpt"});case"categories":return(0,t.createElement)(d,{...l,attribute:"categories",entity:"category"});case"tags":return(0,t.createElement)(d,{...l,attribute:"tags",entity:"post_tag"})}return i(e,s)},l=(e,i)=>{const s={name:i,layer:e,mode:a,fieldset:r,setFieldset:n};return(0,t.createElement)(c.BaseControl,{id:null,label:e.title},(0,t.createElement)(c.Flex,{justify:"flex-start",style:{border:"solid 1px #ccc",padding:"4px",borderRadius:"4px"}},(0,t.createElement)(h,{...s})))};return(()=>{const t=[];for(const a in e){const r=e[a];if(r.dynamic)switch(r.type){case"text":t.push(s(r,a));break;case"image":t.push(l(r,a))}}return t})()},y=({meta:e,templates:r})=>{const{createErrorNotice:l,removeNotice:o}=(0,s.useDispatch)(m.store),u=(0,s.useSelect)((e=>e("core/editor").getCurrentPostId())),d=(0,s.useSelect)((e=>e("core/editor").getEditedPostAttribute("meta")||{})),{editPost:g}=(0,s.useDispatch)("core/editor",[d]),[p,w]=(0,i.useState)(d[e.source]?.template),[E,h]=(0,i.useState)(d[e.fieldset]),[y,b]=(0,i.useState)(!1);return(0,i.useEffect)((()=>{g({meta:{[e.fieldset]:E}})}),[E]),(0,i.useEffect)((()=>{const[e]=Object.keys(r);!r[p]&&e&&w(e)}),[r,p]),(0,t.createElement)(c.Flex,{direction:"column",gap:2,style:{position:"relative"}},d[e.source]?.poster&&(0,t.createElement)("img",{src:d[e.source].poster,alt:(0,a.__)("Sharing Image poster","sharing-image")}),"auto"===d[e.source]?.mode&&(()=>{const e=(0,a.__)("Poster was generated automatically and will update on post saving.","sharing-image");return(0,t.createElement)(c.Dashicon,{icon:"awards",className:"BygBjwYpqPpeTZbVCcRT",title:e})})(),(0,t.createElement)(c.SelectControl,{value:p,options:Object.keys(r).map((e=>({label:r[e].title||(0,a.__)("Untitled","sharing-image"),value:e}))),onChange:t=>{g({meta:{[e.source]:{...d[e.source],template:t}}}),w(t)}}),r[p]&&(0,t.createElement)(c.Flex,{direction:"column",gap:2},(0,t.createElement)(f,{layers:r[p].layers||[],mode:d[e.source]?.mode,fieldset:E,setFieldset:h})),(0,t.createElement)(c.Flex,{justify:"flex-start"},(0,t.createElement)(c.Button,{variant:"secondary",type:"button",onClick:()=>(async()=>{if(y)return;o("sharing-image-generate");const t={path:"sharing-image/v1/poster/"+u,method:"POST",data:{fieldset:E,template:p}};b(!0);try{const a=await n()(t);if(!a.data)throw new Error;g({meta:{[e.source]:{...a.data,template:p}}})}catch(e){l((0,a.__)("An unexpected error occurred","sharing-image"),{id:"sharing-image-generate",type:"snackbar"})}b(!1)})()},(0,a.__)("Generate","sharing-image")),(0,t.createElement)(c.Button,{variant:"tertiary",isDestructive:!0,onClick:()=>{g({meta:{[e.source]:{}}})}},(0,a.__)("Remove","sharing-image")),y&&(0,t.createElement)(c.Spinner,null)))};(0,l.registerPlugin)("sharing-image-sidebar",{render:()=>{const e=window.sharingImageSidebar||{};if(e.meta?.source&&e.meta?.fieldset)return(0,t.createElement)(o.PluginDocumentSettingPanel,{name:"sharing-image-sidebar",title:(0,a.__)("Sharing Image","sharing-image")},(0,t.createElement)(y,{...e}))}})})();